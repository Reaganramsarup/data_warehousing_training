CREATE OR REPLACE PROCEDURE DATA_WAREHOUSE.PUBLIC.LOAD_DETAIL_FACT(START_DATE DATE DEFAULT NULL, END_DATE DATE DEFAULT NULL)
RETURNS VARCHAR NOT NULL
LANGUAGE SQL
AS

--Declaring variables
DECLARE     V_START_SK INT;
            V_END_SK INT;
            
BEGIN
--Setting the dates to the SK variables
 V_START_SK := TO_NUMBER(REPLACE(TO_CHAR(START_DATE), '-', ''));
 V_END_SK := TO_NUMBER(REPLACE(TO_CHAR(END_DATE), '-', ''));

--Performing the delete
DELETE FROM DATA_WAREHOUSE.PUBLIC.FACT_DETAIL
WHERE DATE_SK BETWEEN :V_START_SK AND :V_END_SK;

--Performing the insert
INSERT INTO DATA_WAREHOUSE.PUBLIC.FACT_DETAIL
(TRUCK_SK,
LOCATION_SK,
CUSTOMER_SK,
CURRENCY_SK,
DATE_SK,
MENU_ITEM_SK,
QUANTITY,
UNIT_PRICE)
SELECT 
TRUCK_SK,
LOCATION_SK,
CUSTOMER_SK,
CURRENCY_SK,
DATE_SK,
MENU_ITEM_SK,
QUANTITY,
UNIT_PRICE
FROM DATA_WAREHOUSE.PUBLIC.VIRTUAL_DETAIL_FACT
WHERE DATE_SK BETWEEN :V_START_SK AND :V_END_SK;

RETURN 'Load is complete';

END;
