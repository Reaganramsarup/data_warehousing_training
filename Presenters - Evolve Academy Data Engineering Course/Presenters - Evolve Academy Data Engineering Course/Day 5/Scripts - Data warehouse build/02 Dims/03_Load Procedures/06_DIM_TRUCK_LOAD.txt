CREATE OR REPLACE PROCEDURE DATA_WAREHOUSE.PUBLIC.LOAD_DIM_TRUCK()
RETURNS VARCHAR NOT NULL
LANGUAGE SQL
AS

BEGIN
MERGE INTO DATA_WAREHOUSE.PUBLIC.DIM_TRUCK
USING (
SELECT
TRUCK_ID,
REGION,
COUNTRY,
YEAR,
MAKE,
MODEL,
TRUCK_BRAND_NAME
FROM DATA_WAREHOUSE.PUBLIC.VIRTUAL_DIM_TRUCK
) AS b ON DIM_TRUCK.TRUCK_ID = b.TRUCK_ID
  WHEN MATCHED THEN UPDATE 
  SET 
    REGION = b.REGION,
    COUNTRY = b.COUNTRY,
    YEAR = b.YEAR,
    MAKE = b.MAKE,
    MODEL = b.MODEL,
    TRUCK_BRAND_NAME = b. TRUCK_BRAND_NAME
  
  WHEN NOT MATCHED THEN 
  INSERT 
  ( TRUCK_SK,
    TRUCK_ID,
    REGION,
    COUNTRY,
    YEAR,
    MAKE,
    MODEL,
    TRUCK_BRAND_NAME
  ) 
   VALUES 
   (SEQ_TRUCK_SK.nextval, 
    b.TRUCK_ID,
    b.REGION,
    b.COUNTRY,
    b.YEAR,
    b.MAKE,
    b.MODEL,
    b.TRUCK_BRAND_NAME);

RETURN 'Load is complete';

END;

