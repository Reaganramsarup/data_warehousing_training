CREATE OR REPLACE PROCEDURE DATA_WAREHOUSE.PUBLIC.LOAD_DIM_GEOGRAPHY()
RETURNS VARCHAR NOT NULL
LANGUAGE SQL
AS

BEGIN
MERGE INTO DATA_WAREHOUSE.PUBLIC.DIM_GEOGRAPHY 
USING (
SELECT
LOCATION_ID,
CITY,
REGION,
COUNTRY,
COUNTRY_POPULATION AS COUNTRY_POPULATION_SIZE
FROM DATA_WAREHOUSE.PUBLIC.VIRTUAL_DIM_GEOGRAPHY 
) AS b ON DIM_GEOGRAPHY.LOCATION_ID = b.LOCATION_ID
  WHEN MATCHED THEN UPDATE 
  SET 
  CITY = b.CITY,
  REGION = b.REGION,
  COUNTRY = b.COUNTRY,
  COUNTRY_POPULATION_SIZE = b.COUNTRY_POPULATION_SIZE
  
  WHEN NOT MATCHED THEN 
  INSERT 
  ( LOCATION_SK,
    LOCATION_ID,
    CITY,
    REGION,
    COUNTRY,
    COUNTRY_POPULATION_SIZE
  ) 
   VALUES 
   (SEQ_LOCATION_SK.nextval, 
    b.LOCATION_ID,
    b.CITY,
    b.REGION,
    b.COUNTRY,
    b.COUNTRY_POPULATION_SIZE );

RETURN 'Load is complete';

END;

