
CREATE OR REPLACE PROCEDURE DATA_WAREHOUSE.PUBLIC.LOAD_DIM_FRANCHISE()
RETURNS VARCHAR NOT NULL
LANGUAGE SQL
AS

BEGIN
MERGE INTO DATA_WAREHOUSE.PUBLIC.DIM_FRANCHISE
USING (
SELECT
FRANCHISE_ID,
FIRST_NAME,
LAST_NAME,
FULL_NAME,
CITY,
COUNTRY,
E_MAIL,
PHONE_NUMBER
FROM DATA_WAREHOUSE.PUBLIC.VIRTUAL_DIM_FRANCHISE 
) AS b ON DIM_FRANCHISE.FRANCHISE_ID = b.FRANCHISE_ID
  WHEN MATCHED THEN UPDATE 
  SET 
  FIRST_NAME = b.FIRST_NAME,
  LAST_NAME = b.LAST_NAME,
  FULL_NAME = b.FULL_NAME,
  CITY = b.CITY,
  COUNTRY = b.COUNTRY,
  E_MAIL = b.E_MAIL,
  PHONE_NUMBER = b.PHONE_NUMBER
  
  WHEN NOT MATCHED THEN 
  INSERT 
  ( FRANCHISE_SK,
    FRANCHISE_ID,
    FIRST_NAME,
    LAST_NAME,
    FULL_NAME,
    CITY,
    COUNTRY,
    E_MAIL,
    PHONE_NUMBER
  ) 
   VALUES 
   (SEQ_FRANCHISE_SK.nextval, 
    b.FRANCHISE_ID,
    b.FIRST_NAME,
    b.LAST_NAME,
    b.FULL_NAME,
    b.CITY,
    b.COUNTRY,
    b.E_MAIL,
    b.PHONE_NUMBER );

RETURN 'Load is complete';

END;

