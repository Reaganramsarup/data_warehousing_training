-- FIRST, LETS CREATE A VIEW TO SIMPLIFY THE PROCESS
CREATE VIEW SUPPORTING_DATA.PUBLIC.SALES_PER_MONTH AS 
	SELECT 
		O.ORDER_AMOUNT, 
		D.MONTHSHORTNAME 
	FROM HOL_DB.RAW_POS.ORDER_HEADER O
	JOIN SUPPORTING_DATA.PUBLIC.ENHANCED_DATE_TABLE D
	ON TO_DATE(O.ORDER_TS) = D.DATE
	WHERE D.YEARNUMBER = 2022;

--LETS GET A DISTINCT LIST OF MONTH NAMES
	SELECT DISTINCT MONTHSHORTNAME
    FROM SUPPORTING_DATA.PUBLIC.SALES_PER_MONTH

--DISTINCT LIST OF MONTH NAMES
('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov')

-- WRITE THE PIVOT FUNCTION

	SELECT * 
	FROM SUPPORTING_DATA.PUBLIC.SALES_PER_MONTH
    PIVOT(SUM(ORDER_AMOUNT) FOR MONTHSHORTNAME IN ('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov'))
    AS p