CREATE OR REPLACE PROCEDURE DATA_WAREHOUSE.PUBLIC.LOAD_AGGREGATED_FACT(START_DATE DATE DEFAULT NULL, END_DATE DATE DEFAULT NULL)
RETURNS VARCHAR NOT NULL
LANGUAGE SQL
AS

--Declaring variables
DECLARE     V_START_SK INT;
            V_END_SK INT;
            
BEGIN
--Setting the dates to the SK variables
 V_START_SK := TO_NUMBER(REPLACE(TO_CHAR(START_DATE), '-', ''));
 V_END_SK := TO_NUMBER(REPLACE(TO_CHAR(END_DATE), '-', ''));

--Performing the delete
DELETE FROM DATA_WAREHOUSE.PUBLIC.FACT_AGGREGATED
WHERE DATE_SK BETWEEN :V_START_SK AND :V_END_SK;

--Performing the insert
INSERT INTO DATA_WAREHOUSE.PUBLIC.FACT_AGGREGATED
(TRUCK_SK,
LOCATION_SK,
CUSTOMER_SK,
CURRENCY_SK,
DATE_SK,
ORDER_AMOUNT)
SELECT 
TRUCK_SK,
LOCATION_SK,
CUSTOMER_SK,
CURRENCY_SK,
DATE_SK,
ORDER_AMOUNT
FROM DATA_WAREHOUSE.PUBLIC.VIRTUAL_AGGREGATED_FACT
WHERE DATE_SK BETWEEN :V_START_SK AND :V_END_SK;

RETURN 'Load is complete';

END;